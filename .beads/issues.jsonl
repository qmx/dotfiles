{"id":"nix-081","title":"Update nfs-synology module options","description":"Update modules/nixos/nfs-synology.nix to match existing NFS mount options used by sirannon/orthanc:\n\nCurrent options: x-systemd.automount, noauto, x-systemd.idle-timeout=600\nNeeded options: rw, hard, intr, nfsvers=4, x-systemd.automount, x-systemd.idle-timeout=600\n\nAlso add boot.supportedFilesystems = [ \"nfs\" ]; to the module.\n\nVerify: nix flake check","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:50:48.816084353-05:00","updated_at":"2025-12-24T00:49:47.334324022-05:00","closed_at":"2025-12-24T00:49:47.334330083-05:00"}
{"id":"nix-0ph","title":"Refactor home-manager YubiKey config into reusable module","description":"Extract existing home-manager YubiKey configuration into modules/home-manager/yubikey/.\n\nCurrent state:\n- Some home-manager config generates ~/.config/yubikey-udev/70-yubikey-usb.rules\n- devShell warns user to manually copy rules to /etc/udev/rules.d/\n- Used on non-NixOS Linux machines (wk3, k01) where HM can't do system-level config\n\nGoal:\n- Create modules/home-manager/yubikey/default.nix\n- Generate udev rules file for manual installation\n- Keep devShell warning for non-NixOS systems\n- This is separate from modules/nixos/yubikey.nix which handles NixOS systems directly\n\nFind existing yubikey home-manager config and consolidate into the module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T00:39:13.060226363-05:00","updated_at":"2025-12-25T00:20:10.157689161-05:00","closed_at":"2025-12-25T00:20:10.157689161-05:00","close_reason":"Closed"}
{"id":"nix-1od","title":"Add ncps to erebor host config","description":"Update hosts/erebor/nixos/default.nix - import ncps module, enable services.nix-cache-proxy with storagePath=/mnt/nix-cache. Attic config stays unchanged on port 8080.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T17:13:58.639688829-05:00","updated_at":"2025-12-25T17:20:22.389500581-05:00","closed_at":"2025-12-25T17:20:22.389500581-05:00","close_reason":"Closed"}
{"id":"nix-1sf","title":"Add nixfmt to repo","description":"Add nixfmt for consistent Nix code formatting. Include in devShell and consider adding a pre-commit hook or CI check.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:44:30.187597497-05:00","updated_at":"2025-12-07T19:52:36.194812778-05:00","closed_at":"2025-12-07T19:52:36.194812778-05:00"}
{"id":"nix-1xc","title":"Create imladris NixOS config","description":"Create hosts/imladris/nixos/default.nix that imports the new modules and sets host-specific config.\n\n## Directory structure:\n- Create hosts/imladris/nixos/ directory\n\n## File: hosts/imladris/nixos/default.nix\n\n```nix\n{ username, ... }:\n\n{\n  imports = [\n    ../../../modules/nixos/base.nix\n    ../../../modules/nixos/vm.nix\n    ../../../modules/nixos/nfs-synology.nix\n  ];\n\n  networking.hostName = \"imladris\";\n\n  # Passwords - use hashes from secrets/secrets.json.age (passwords.qmx and passwords.root)\n  users.users.${username}.initialHashedPassword = \"\u003cqmx hash from secrets\u003e\";\n  users.users.root.initialHashedPassword = \"\u003croot hash from secrets\u003e\";\n\n  # NFS mounts (backups and media, not models)\n  nfs-synology = {\n    enable = true;\n    mounts = [ \"backups\" \"media\" ];\n  };\n\n  system.stateVersion = \"25.05\";\n}\n```\n\n## Note:\nDecrypt secrets.json.age to get the actual password hashes for qmx and root.\n\n## Verification:\n```bash\nnix flake check\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:33:39.904327978-05:00","updated_at":"2025-12-23T23:37:46.804970402-05:00","closed_at":"2025-12-23T23:37:46.804970402-05:00","close_reason":"Closed"}
{"id":"nix-27n","title":"Change default opencode model to Qwen3-Coder-30B-Q8-200K-3x-KVQ8 for planning and build modes","description":"Change opencode default model from Qwen3-Coder-30B-Q6-128K-4x to Qwen3-Coder-30B-Q8-200K-3x-KVQ8 for both planning and build modes. This model provides higher quality (Q8) with 200K context per slot across 3 parallel slots.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:55:15.583498629-05:00","updated_at":"2025-12-25T01:36:49.184393703-05:00","closed_at":"2025-12-25T01:36:49.184393703-05:00","close_reason":"Closed"}
{"id":"nix-2pr","title":"Drop beads-viewer package","description":"Remove beads-viewer from the repository. It's no longer needed.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-25T10:53:17.502283212-05:00","updated_at":"2025-12-25T11:45:37.885425972-05:00","closed_at":"2025-12-25T11:45:37.885425972-05:00","close_reason":"Closed"}
{"id":"nix-30q","title":"Create modules/nixos/vm.nix","description":"Create VM-specific NixOS module with QEMU guest profile, EFI boot, and auto-resize filesystem.\n\n## File: modules/nixos/vm.nix\n\n```nix\n{ modulesPath, ... }:\n\n{\n  imports = [\n    \"${modulesPath}/profiles/qemu-guest.nix\"\n  ];\n\n  # EFI boot\n  boot.loader.systemd-boot.enable = true;\n  boot.loader.efi.canTouchEfiVariables = true;\n  boot.growPartition = true;\n  boot.kernelParams = [ \"console=ttyS0\" ];\n\n  # Auto-resize filesystem\n  fileSystems.\"/\" = {\n    device = \"/dev/disk/by-label/nixos\";\n    autoResize = true;\n    fsType = \"ext4\";\n  };\n  fileSystems.\"/boot\" = {\n    device = \"/dev/disk/by-label/ESP\";\n    fsType = \"vfat\";\n  };\n\n  # Networking\n  networking.useDHCP = true;\n}\n```\n\n## Verification:\n```bash\nnix flake check\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:32:29.071504552-05:00","updated_at":"2025-12-23T23:36:10.060894981-05:00","closed_at":"2025-12-23T23:36:10.060894981-05:00","close_reason":"Closed"}
{"id":"nix-3g7","title":"Add nixos-hardware flake input","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T23:29:19.561200146-05:00","updated_at":"2025-12-17T23:29:43.722745552-05:00","closed_at":"2025-12-17T23:29:43.722745552-05:00"}
{"id":"nix-3ga","title":"Create experiment for fetching HuggingFace models via Nix and storing in local cache","description":"Create Nix derivations that fetch GGUF model files from HuggingFace, store them in the Nix store, and serve them via the local Attic cache. Changes llama-swap from runtime -hf download to -m with pre-fetched store paths.","notes":"Full implementation plan with code examples: /home/qmx/.claude/plans/sunny-noodling-summit.md\n\nKey design decisions:\n- Two-tier: ggufs catalog (artifacts) + models catalog (configs)\n- Indexed by HF identifier: org/repo-GGUF:quantization\n- Graceful fallback: models not in ggufs use runtime -hf\n- Import existing ~900GB without re-download via nix-store --add-fixed\n- Push to Attic for cross-host caching","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-25T00:55:15.78114729-05:00","updated_at":"2025-12-25T23:33:21.549728482-05:00"}
{"id":"nix-3ga.1","title":"Configure orthanc as Attic push client","description":"Set up orthanc to push derivations to Attic cache on erebor:\n\n1. On erebor: Create push token with 'attic token create orthanc --push main'\n2. Add attic-client package to hosts/orthanc/home-manager/default.nix\n3. Add atticClientToken to secrets/secrets.json.age\n4. Create templates/attic-config.toml.j2 template\n5. Add secrets activation to write ~/.config/attic/config.toml\n\nBlocker for: importing and pushing existing models","notes":"Attic client config format (~/.config/attic/config.toml):\n\n[servers.erebor]\nendpoint = \"http://erebor:8080\"\ntoken = \"\u003cjwt-token\u003e\"\n\n[default]\nserver = \"erebor\"\n\nSecrets structure:\n  secrets.json: add atticClientToken field\n  templates/attic-config.toml.j2: use {{ atticClientToken }}\n\nFiles to modify:\n  - hosts/orthanc/home-manager/default.nix (add pkgs.attic-client)\n  - secrets/secrets.json.age (add token)\n  - templates/attic-config.toml.j2 (new file)\n  - modules/home-manager/secrets or host config (activation for config.toml)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T23:29:47.612286334-05:00","updated_at":"2025-12-26T00:42:04.662520557-05:00","closed_at":"2025-12-26T00:42:04.662520557-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-3ga.1","depends_on_id":"nix-3ga","type":"parent-child","created_at":"2025-12-25T23:29:47.624116211-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.2","title":"Add ggufs catalog to lib/models.nix","description":"Create the ggufs catalog structure in lib/models.nix:\n\n- Add ggufs = { ... } alongside existing models and groupConfigs\n- Indexed by HuggingFace identifier (e.g., 'unsloth/SmolLM3-3B-128K-GGUF:Q4_K_XL')\n- Each entry has: file (string) and sha256 (string)\n- Support for split files: files = [{ name; sha256; }...]\n- Start with placeholder hashes\n\nNo dependencies - can start immediately.","notes":"Schema examples:\n\nSingle file:\n  \"unsloth/SmolLM3-3B-128K-GGUF:Q4_K_XL\" = {\n    file = \"SmolLM3-3B-128K-UD-Q4_K_XL.gguf\";\n    sha256 = \"sha256-AAAA...\";\n  };\n\nSplit files:\n  \"org/Model-GGUF:Q8_K_XL\" = {\n    files = [\n      { name = \"Model-Q8_K_XL-00001-of-00002.gguf\"; sha256 = \"...\"; }\n      { name = \"Model-Q8_K_XL-00002-of-00002.gguf\"; sha256 = \"...\"; }\n    ];\n  };\n\nExport from lib/default.nix:\n  ggufs = catalog.ggufs;\n  # Add to export set","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T23:29:56.074194931-05:00","updated_at":"2025-12-26T00:53:36.69747911-05:00","closed_at":"2025-12-26T00:53:36.69747911-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-3ga.2","depends_on_id":"nix-3ga","type":"parent-child","created_at":"2025-12-25T23:29:56.078015022-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.3","title":"Update llama-swap module with fetchGGUF","description":"Modify modules/home-manager/llama-swap/default.nix:\n\n1. Import ggufs catalog from lib\n2. Add fetchGGUF helper function that:\n   - Returns null if hfId not in ggufs (graceful fallback)\n   - Handles single files (fetchurl)\n   - Handles split files (fetch all, symlink into directory)\n3. Update buildCmd to use -m ${ggufPath} when available, else -hf\n4. Same for draft models: -mrd vs -hfrd\n5. Keep LLAMA_CACHE during migration for fallback models\n\nDepends on: nix-3ga.2","notes":"Broken down into sub-tasks 3a-3e. Original scope was too large - need to validate mechanism first before integrating.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T23:30:05.789542647-05:00","updated_at":"2025-12-26T01:15:29.917153403-05:00","dependencies":[{"issue_id":"nix-3ga.3","depends_on_id":"nix-3ga","type":"parent-child","created_at":"2025-12-25T23:30:05.792311269-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.3.1","title":"Fetch SmolLM3-3B-Q4 into Nix store with hash","description":"Goal: Prove we can fetch a GGUF from HuggingFace into the Nix store with integrity verification.\n\nSteps:\n1. Get sha256 hash:\n   nix-prefetch-url --type sha256 https://huggingface.co/unsloth/SmolLM3-3B-128K-GGUF/resolve/main/SmolLM3-3B-128K-UD-Q4_K_XL.gguf\n\n2. Add to lib/models.nix ggufs catalog:\n   \"unsloth/SmolLM3-3B-128K-GGUF:Q4_K_XL\" = {\n     file = \"SmolLM3-3B-128K-UD-Q4_K_XL.gguf\";\n     sha256 = \"\u003chash-from-step-1\u003e\";\n   };\n\n3. Create test derivation or use nix-build to verify fetch works\n\nFiles: lib/models.nix","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T01:15:50.438256829-05:00","updated_at":"2025-12-26T01:24:21.525968672-05:00","closed_at":"2025-12-26T01:24:21.525968672-05:00","close_reason":"Added SmolLM3-3B-Q4 to ggufs catalog with verified sha256. Store path: /nix/store/ziqwc7rdy8yz81p6q91y3maf3d64cwvq-SmolLM3-3B-128K-UD-Q4_K_XL.gguf (1.9G)","dependencies":[{"issue_id":"nix-3ga.3.1","depends_on_id":"nix-3ga.3","type":"parent-child","created_at":"2025-12-26T01:15:50.441853296-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.3.2","title":"Push test model to Attic cache","description":"Goal: Verify we can push the fetched GGUF to the Attic binary cache on erebor.\n\nSteps:\n1. Build the model derivation to get store path\n2. Push to Attic:\n   attic push main /nix/store/xxx-SmolLM3-3B-128K-UD-Q4_K_XL.gguf\n3. Verify with: attic cache info main\n\nDepends on: nix-3ga.3.1, nix-3ga.1 (orthanc as Attic client)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T01:16:01.456405885-05:00","updated_at":"2025-12-26T01:16:01.456405885-05:00","dependencies":[{"issue_id":"nix-3ga.3.2","depends_on_id":"nix-3ga.3","type":"parent-child","created_at":"2025-12-26T01:16:01.459210791-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.3.3","title":"Verify cross-host pull from Attic","description":"Goal: Confirm another machine can pull the model from Attic instead of re-downloading from HuggingFace.\n\nSteps:\n1. On a different host (or clear local store):\n   - Ensure Attic substituter is configured\n   - Reference the store path\n2. Verify it pulls from http://erebor:8080 (check logs or network)\n3. Confirm model file is usable\n\nDepends on: nix-3ga.3.2","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T01:16:21.022557261-05:00","updated_at":"2025-12-26T01:16:21.022557261-05:00","dependencies":[{"issue_id":"nix-3ga.3.3","depends_on_id":"nix-3ga.3","type":"parent-child","created_at":"2025-12-26T01:16:21.025294269-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.3.4","title":"Add explicit source indicator to llama-swap config","description":"Goal: Make it visually clear whether a model uses Nix store path (-m) or runtime download (-hf).\n\nOptions:\n- Add comment in generated YAML config\n- Use model name suffix like [nix] or [hf]\n- Log message during config generation\n\nFiles: modules/home-manager/llama-swap/default.nix\n\nDepends on: nix-3ga.3.3 (after validation)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T01:16:21.151988473-05:00","updated_at":"2025-12-26T01:16:21.151988473-05:00","dependencies":[{"issue_id":"nix-3ga.3.4","depends_on_id":"nix-3ga.3","type":"parent-child","created_at":"2025-12-26T01:16:21.153035085-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.3.5","title":"Integrate fetchGGUF into llama-swap module","description":"Goal: Full integration - llama-swap uses -m /nix/store/... for models in ggufs catalog, falls back to -hf for others.\n\nImplementation:\n1. Import ggufs catalog in llama-swap module\n2. Add fetchGGUF helper function that:\n   - Returns null if hfId not in ggufs (graceful fallback)\n   - Handles single files (fetchurl)\n   - Handles split files (fetch all, symlink into directory)\n3. Update buildCmd to use -m ${ggufPath} when available, else -hf\n4. Same for draft models: -mrd vs -hfrd\n\nFiles: modules/home-manager/llama-swap/default.nix\n\nDepends on: nix-3ga.3.4","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-26T01:16:22.150620377-05:00","updated_at":"2025-12-26T01:16:22.150620377-05:00","dependencies":[{"issue_id":"nix-3ga.3.5","depends_on_id":"nix-3ga.3","type":"parent-child","created_at":"2025-12-26T01:16:22.153987302-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.4","title":"Import existing models and push to Attic","description":"Import ~900GB of existing models from ~/.local/share/llama-models/ to Nix store and push to Attic:\n\n1. Run batch import script on orthanc\n2. For each .gguf file:\n   - Compute hash with 'nix hash file'\n   - Import to store with 'nix-store --add-fixed sha256 --name \u003chf-filename\u003e'\n   - Push to Attic with 'attic push main'\n3. Handle split files (group by HF ID)\n4. Handle mmproj files for vision models\n5. Output ggufs catalog entries\n\nDepends on: nix-3ga.1 (Attic push access configured)","notes":"Local cache filename pattern: {org}_{repo}_{hf-filename}.gguf\nExample: unsloth_SmolLM3-3B-128K-GGUF_SmolLM3-3B-128K-UD-Q4_K_XL.gguf\n\nBatch script parsing:\n  org=$(echo \"$local_name\" | cut -d_ -f1)\n  repo=$(echo \"$local_name\" | cut -d_ -f2)\n  hf_filename=$(echo \"$local_name\" | sed \"s/^${org}_${repo}_//\")\n  quant=$(echo \"$hf_filename\" | grep -oE 'Q[0-9]+_K(_[A-Z]+)?' | tail -1)\n  hf_id=\"${org}/${repo}:${quant}\"\n\nImport commands:\n  hash=$(nix hash file \"$local_file\")\n  store_path=$(nix-store --add-fixed sha256 --name \"$hf_filename\" \"$local_file\")\n  attic push main \"$store_path\"\n\nSplit files have extra component: {org}_{repo}_{quant-folder}_{hf-filename}.gguf\nmmproj files (vision): skip or handle separately","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T23:30:16.556124945-05:00","updated_at":"2025-12-25T23:32:54.655747401-05:00","dependencies":[{"issue_id":"nix-3ga.4","depends_on_id":"nix-3ga","type":"parent-child","created_at":"2025-12-25T23:30:16.559215292-05:00","created_by":"daemon"}]}
{"id":"nix-3ga.5","title":"Populate ggufs catalog with hashes","description":"Add real sha256 hashes to ggufs catalog in lib/models.nix:\n\n1. Use hashes from nix-3ga.4 batch import output\n2. Map local cache filenames to HuggingFace identifiers\n3. Add entries for all unique hf values in models catalog\n4. Handle split files with files = [...] format\n5. Test with home-manager switch\n\nDepends on: nix-3ga.2, nix-3ga.4","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-25T23:30:23.536789221-05:00","updated_at":"2025-12-25T23:30:23.536789221-05:00","dependencies":[{"issue_id":"nix-3ga.5","depends_on_id":"nix-3ga","type":"parent-child","created_at":"2025-12-25T23:30:23.539419021-05:00","created_by":"daemon"}]}
{"id":"nix-4ec","title":"Wire up imladris in flake.nix","description":"Add imladris to linuxHosts and nixosConfigurations in flake.nix.\n\n## Changes to flake.nix:\n\n1. Add imladris to linuxHosts map (after orthanc, around line 138):\n```nix\nimladris = {\n  system = \"x86_64-linux\";\n  modules = [ ];\n};\n```\n\n2. Add imladris to nixosConfigurations (after sirannon block, around line 223):\n```nix\nnixosConfigurations.\"imladris\" = nixpkgs-nixos.lib.nixosSystem {\n  system = \"x86_64-linux\";\n  modules = [ ./hosts/imladris/nixos ];\n  specialArgs = { inherit username; };\n};\n```\n\n## Verification:\n```bash\nnix flake check\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:33:56.264374249-05:00","updated_at":"2025-12-23T23:42:43.158084372-05:00","closed_at":"2025-12-23T23:42:43.158084372-05:00","close_reason":"Added imladris to linuxHosts and nixosConfigurations in flake.nix. Verified with nix flake check."}
{"id":"nix-5l0","title":"Add nix-prefetch-github to devShell","description":"Add nix-prefetch-github to the flake devShell for easier package version fetching.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-24T01:26:35.961975665-05:00","updated_at":"2025-12-24T01:59:20.1073648-05:00","closed_at":"2025-12-24T01:59:20.1073648-05:00","close_reason":"Added to devShell buildInputs and updated CLAUDE.md"}
{"id":"nix-5o5","title":"Create modules/nixos/nfs-synology.nix","description":"Create configurable NFS module for Synology mounts with options for selecting which shares to mount.\n\n## File: modules/nixos/nfs-synology.nix\n\n```nix\n{ config, lib, ... }:\n\nlet\n  cfg = config.nfs-synology;\n  shareConfigs = {\n    models = { device = \"192.168.1.200:/volume1/models\"; mountPoint = \"/mnt/models\"; };\n    backups = { device = \"192.168.1.200:/volume1/backups\"; mountPoint = \"/mnt/backups\"; };\n    media = { device = \"192.168.1.200:/volume1/media\"; mountPoint = \"/mnt/media\"; };\n  };\nin\n{\n  options.nfs-synology = {\n    enable = lib.mkEnableOption \"Synology NFS mounts\";\n    mounts = lib.mkOption {\n      type = lib.types.listOf (lib.types.enum [ \"models\" \"backups\" \"media\" ]);\n      default = [ ];\n      description = \"Which Synology shares to mount\";\n    };\n  };\n\n  config = lib.mkIf cfg.enable {\n    fileSystems = lib.listToAttrs (map (name: {\n      name = shareConfigs.${name}.mountPoint;\n      value = {\n        device = shareConfigs.${name}.device;\n        fsType = \"nfs\";\n        options = [ \"x-systemd.automount\" \"noauto\" \"x-systemd.idle-timeout=600\" ];\n      };\n    }) cfg.mounts);\n  };\n}\n```\n\n## Verification:\n```bash\nnix flake check\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:32:44.978178122-05:00","updated_at":"2025-12-23T23:36:50.835058674-05:00","closed_at":"2025-12-23T23:36:50.835058674-05:00","close_reason":"Closed"}
{"id":"nix-66m","title":"Fix Home Manager / Nixpkgs version mismatch warning","description":"When building imladris-qcow2, there's a version mismatch warning:\n\n  Home Manager version 26.05 and Nixpkgs version 25.11.\n\nThis happens because:\n- home-manager input follows nixpkgs-unstable (26.05)\n- nixos-generators uses nixpkgs-nixos (25.11) for the NixOS system\n\nOptions to fix:\n1. Pin home-manager to release-25.11 branch (matches nixpkgs-nixos)\n2. Add home.enableNixpkgsReleaseCheck = false; to image-home-manager.nix\n3. Use nixpkgs-unstable for VM images too\n\nRecommended: Option 1 - use matching home-manager release for consistency.\n\nUpdate flake.nix home-manager input:\n  home-manager.url = \"github:nix-community/home-manager/release-25.11\";\n\nVerify: nix build .#imladris-qcow2 (no warning)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T23:52:16.985637051-05:00","updated_at":"2025-12-24T00:26:14.690173274-05:00","closed_at":"2025-12-24T00:26:14.690178073-05:00"}
{"id":"nix-6ln","title":"Migrate orthanc to new modules","description":"Update hosts/orthanc/nixos/default.nix to use new modules.\n\nImport these modules:\n- ../../../modules/nixos/base.nix\n- ../../../modules/nixos/nfs-synology.nix\n- ../../../modules/nixos/yubikey.nix\n\nKeep host-specific config:\n- hardware-configuration.nix import\n- nixpkgs.overlays (linux-firmware pin)\n- boot.loader.systemd-boot\n- boot.kernelPackages (6.18)\n- boot.kernelParams (AMD GPU params)\n- time.timeZone\n- virtualisation.docker.enable\n- Extra user groups: docker (via lib.mkAfter)\n- Extra packages: btop-rocm, neovim, pciutils, rocmPackages.rocm-smi, tmux, wget\n- programs.mosh.enable\n- services.fwupd.enable\n\nConfigure nfs-synology:\n  enable = true;\n  mounts = [ \"models\" \"backups\" \"media\" ];\n\nRemove duplicated config that's now in modules:\n- User setup (except extraGroups addition)\n- openssh, tailscale, timesyncd services\n- programs.zsh.enable\n- vim package (already in base)\n- YubiKey config\n\nVerify: nix flake check","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:51:14.926261967-05:00","updated_at":"2025-12-24T01:06:17.459142538-05:00","closed_at":"2025-12-24T01:06:17.45914897-05:00"}
{"id":"nix-7ud","title":"Enable fwupd and timesyncd services","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T23:29:19.849392374-05:00","updated_at":"2025-12-17T23:30:13.437329049-05:00","closed_at":"2025-12-17T23:30:13.437329049-05:00"}
{"id":"nix-88x","title":"Add Qwen3-VL models to orthanc","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T11:23:45.62073736-05:00","updated_at":"2025-12-24T11:24:41.392491859-05:00","closed_at":"2025-12-24T11:24:41.392491859-05:00","close_reason":"Added 4 Qwen3-VL models to lib/models.nix and orthanc localModels","labels":["llama-swap"]}
{"id":"nix-8e7","title":"Create modules/nixos/yubikey.nix","description":"Extract YubiKey/Smart Card support into reusable module.\n\nFrom sirannon/orthanc config, extract:\n- users.groups.plugdev = { };\n- services.pcscd with ccid plugin\n- services.udev.packages with yubikey-personalization\n- services.udev.extraRules for GROUP-based permissions (CCID and HID)\n\nModule should:\n- Add plugdev group\n- Enable pcscd with ccid\n- Add yubikey udev packages and rules\n\nVerify: nix flake check","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:50:56.262867402-05:00","updated_at":"2025-12-24T00:44:27.76331789-05:00","closed_at":"2025-12-24T00:44:27.763322919-05:00"}
{"id":"nix-8f2","title":"Add ncps substituter to base.nix","description":"Update modules/nixos/base.nix - add http://erebor:8081 to substituters list, add ncps public key to trusted-public-keys. Key will be retrieved after first ncps run from /mnt/nix-cache/ncps/cache-key.pub.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T17:14:04.429268647-05:00","updated_at":"2025-12-25T17:20:22.409968383-05:00","closed_at":"2025-12-25T17:20:22.409968383-05:00","close_reason":"Closed"}
{"id":"nix-8yu","title":"Suppress YubiKey udev warning on NixOS systems","description":"The devShell shows a YubiKey udev warning that doesn't apply to NixOS:\n\n  ⚠️  YubiKey SSH Access Not Configured\n  sudo cp ~/.config/yubikey-udev/70-yubikey-usb.rules /etc/udev/rules.d/\n\nThis only makes sense on non-NixOS Linux (e.g., wk3 on Debian) where home-manager can't manage system udev rules.\n\nOn NixOS (orthanc, sirannon, imladris), the yubikey.nix module handles this declaratively.\n\nFix: Detect if running on NixOS and skip the warning. Could check for /etc/NIXOS or similar.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T01:36:51.731262763-05:00","updated_at":"2025-12-24T01:56:35.626361651-05:00","closed_at":"2025-12-24T01:56:35.626361651-05:00","close_reason":"Added /etc/NIXOS check to skip warning on NixOS systems"}
{"id":"nix-aav","title":"Restructure models.nix: nest opencode fields in opencode attribute set instead of using comments, rename llama-models.nix to models.nix","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T16:38:17.788499534-05:00","updated_at":"2025-12-14T23:35:04.024204579-05:00","closed_at":"2025-12-14T23:35:04.024204579-05:00"}
{"id":"nix-alj","title":"Move Claude Code settings to core.nix for cross-machine config","description":"The .claude/settings.local.json should be managed via nix in core.nix so permissions (like git push auto-approval) are consistent across machines. Currently each machine has its own local settings.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T14:57:42.177645454-05:00","updated_at":"2025-12-13T14:58:15.798024259-05:00","closed_at":"2025-12-13T14:58:15.798024259-05:00"}
{"id":"nix-ao0","title":"Fix deprecated 'system' attribute warning","description":"home-manager switch shows deprecation warning:\n\n  'system' has been renamed to/replaced by 'stdenv.hostPlatform.system'\n\nSearch codebase for uses of 'system' that should be replaced with 'stdenv.hostPlatform.system' or use pkgs.system instead.","notes":"## Research (2025-12-24)\n\nThe warning comes from nixpkgs packages that still use the deprecated `system` attribute internally.\n\n### Key findings:\n- google-cloud-sdk was a known culprit (fixed in nixpkgs Nov 2025)\n- Not using google-cloud-sdk in this config\n- Warning likely from another package in nixpkgs-unstable\n- The `import nixpkgs { system = \"...\"; }` pattern is NOT the cause\n\n### Potential fixes:\n1. Wait for nixpkgs to fix offending packages upstream\n2. Find the specific package causing it with `NIX_ABORT_ON_WARN=1`\n3. Replace `${system}` with `${stdenv.hostPlatform.system}` in custom code\n\n### Sources:\n- https://discourse.nixos.org/t/how-to-fix-evaluation-warning-system-has-been-renamed-to-replaced-by-stdenv-hostplatform-system/72120\n- https://github.com/nixos/nixpkgs/issues/460430\n\nLow priority - cosmetic warning only.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-24T01:08:33.259167347-05:00","updated_at":"2025-12-24T01:55:11.627766709-05:00"}
{"id":"nix-ayx","title":"Set kernel to linuxPackages_6_18","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T23:29:19.777657084-05:00","updated_at":"2025-12-17T23:30:08.000023612-05:00","closed_at":"2025-12-17T23:30:08.000023612-05:00"}
{"id":"nix-ayy","title":"Add beads skill to Claude configuration via Nix","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T01:52:14.079152541-05:00","updated_at":"2025-12-18T01:53:17.200032556-05:00","closed_at":"2025-12-18T01:53:17.200032556-05:00","close_reason":"Added beadsSkill to extraSpecialArgs in flake.nix and configured skills in claude module"}
{"id":"nix-b7v","title":"Allow Claude to auto-run bd commands for issue management","description":"Add bd commands to Claude's auto-approval rules so issue management (create, update, close, ready, show) doesn't require manual approval each time. EDIT .claude/settings.json or equivalent config to add bd permissions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:42:45.249641192-05:00","updated_at":"2025-12-13T14:41:34.047050059-05:00","closed_at":"2025-12-13T14:41:34.047050059-05:00"}
{"id":"nix-bca","title":"Create imladris home-manager config","description":"Create hosts/imladris/home-manager/default.nix with minimal config.\n\n## Directory structure:\n- Create hosts/imladris/home-manager/ directory\n\n## File: hosts/imladris/home-manager/default.nix\n\n```nix\n{ ... }:\n\n{\n  imports = [\n    ../../../roles/linux-yubikey/home-manager\n  ];\n\n  home.stateVersion = \"25.05\";\n}\n```\n\n## Verification:\n```bash\nnix flake check\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:33:46.97078889-05:00","updated_at":"2025-12-23T23:40:19.666652557-05:00","closed_at":"2025-12-23T23:40:19.666652557-05:00","close_reason":"Created hosts/imladris/home-manager/default.nix with linux-yubikey role. Verified with nix flake check."}
{"id":"nix-bfq","title":"Add KVQ8 variants for all Qwen3 models without them (12 new variants)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T20:07:10.107498792-05:00","updated_at":"2025-12-25T20:12:13.577663343-05:00","closed_at":"2025-12-25T20:12:13.577663343-05:00","close_reason":"Closed","labels":["enhancement"]}
{"id":"nix-c8s","title":"Package perles Go CLI","description":"Create Nix package for https://github.com/zjrosen/perles (v0.2.13) - terminal kanban for beads.\n\n## Files to Create/Modify\n\n1. **Create** `pkgs/perles/default.nix`\n   - Follow pattern from `pkgs/beads-viewer/default.nix`\n   - Use buildGoModule with fetchFromGitHub\n   - Get hash via: `nix-prefetch-github zjrosen perles --rev v0.2.13`\n   - Get vendorHash from build error (use lib.fakeHash first)\n\n2. **Modify** `pkgs/default.nix`\n   - Add: `perles = prev.callPackage ./perles { };`\n\n3. **Modify** `hosts/meduseld/home-manager/default.nix`\n   - Add `pkgs.perles` to home.packages\n\n4. **Modify** `hosts/orthanc/home-manager/default.nix`\n   - Add `pkgs.perles` to home.packages","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:29:23.869979754-05:00","updated_at":"2025-12-25T12:00:25.564987655-05:00","closed_at":"2025-12-25T12:00:25.564987655-05:00","close_reason":"Closed"}
{"id":"nix-cpc","title":"Add whisper-cpp-vulkan with llama-swap proxy integration","description":"Integrate whisper-cpp for audio transcription via llama-swap proxy mode. User has models at ~/.local/share/whisper-models/ggml-large-v3-turbo.bin. Reference: https://github.com/mostlygeek/llama-swap/issues/41#issuecomment-2722637867","design":"Extend llama-swap module to support proxy-based models (whisper) alongside existing cmd-based LLM models. Key difference: whisper uses proxy+checkEndpoint config instead of hf model downloads.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T21:56:50.347339434-05:00","updated_at":"2025-12-22T22:00:14.102319679-05:00","closed_at":"2025-12-22T22:00:14.102319679-05:00","close_reason":"Completed whisper-cpp-vulkan integration with llama-swap proxy mode. Added package, extended module, configured orthanc."}
{"id":"nix-cwq","title":"Extend llama-swap module for proxy models","description":"Add proxyModels option to llama-swap module supporting: package, binary, port, checkEndpoint, modelPath, extraArgs. Generate YAML with proxy config instead of cmd+hf pattern.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T21:57:04.486442245-05:00","updated_at":"2025-12-22T21:59:48.302589069-05:00","closed_at":"2025-12-22T21:59:48.302589069-05:00","close_reason":"Added proxyModels option to llama-swap module with package, binary, port, checkEndpoint, modelPath, ttl, aliases, extraArgs, group options. Updated config generation to merge proxy models with LLM models.","dependencies":[{"issue_id":"nix-cwq","depends_on_id":"nix-cpc","type":"parent-child","created_at":"2025-12-22T21:57:18.190501821-05:00","created_by":"daemon"}]}
{"id":"nix-d0m","title":"Add Claude Code hook to prevent git push","description":"Prevent Claude Code from running git push commands.\n\nOptions (choose one or combine):\n\n1. Permissions Deny List (recommended):\n   Add to .claude/settings.json:\n   {\n     \"permissions\": {\n       \"deny\": [\"Bash(git push:*)\"]\n     }\n   }\n\n2. PreToolUse Hook (more control):\n   Create hook script that checks command and returns:\n   {\"permissionDecision\": \"deny\", \"permissionDecisionReason\": \"Git push blocked\"}\n\nImplementation location: core.nix/home-manager/claude/default.nix\nCurrently has auto-approve list but no deny list.\n\nNote: Deny takes precedence over allow/ask rules.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T23:34:17.328497545-05:00","updated_at":"2025-12-26T00:19:16.149692145-05:00","closed_at":"2025-12-26T00:19:16.149692145-05:00","close_reason":"Closed"}
{"id":"nix-dhu","title":"Remove Qwen3-30B-Thinking-2507-Q8-256K-Spec model","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T20:07:10.193814919-05:00","updated_at":"2025-12-25T20:12:13.492063351-05:00","closed_at":"2025-12-25T20:12:13.492063351-05:00","close_reason":"Closed","labels":["cleanup"]}
{"id":"nix-e4u","title":"Extend base.nix with timezone, experimental-features, stateVersion","description":"Add to modules/nixos/base.nix:\n\n- time.timeZone = \"America/New_York\";\n- nix.settings.experimental-features = [ \"nix-command\" \"flakes\" ];\n- system.stateVersion = ... (need to decide: parameterize or use fixed value?)\n\nNote: stateVersion is typically machine-specific (reflects install date). Consider:\n- Making it a module option with default\n- Or keeping it in host configs\n\nBlocks: nix-msp (sirannon migration)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T00:43:24.685548757-05:00","updated_at":"2025-12-24T00:46:13.944683763-05:00","closed_at":"2025-12-24T00:46:13.944689995-05:00"}
{"id":"nix-e6g","title":"Unify mkLinuxHome with system and modules parameters","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T10:11:35.053626475-05:00","updated_at":"2025-12-23T10:14:28.226284443-05:00","closed_at":"2025-12-23T10:14:28.226284443-05:00","close_reason":"Closed"}
{"id":"nix-epf","title":"Update nixpkgs-nixos to nixos-25.11","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T23:29:19.634733503-05:00","updated_at":"2025-12-17T23:29:48.601375938-05:00","closed_at":"2025-12-17T23:29:48.601375938-05:00"}
{"id":"nix-eyq","title":"Retire k01 host configuration","description":"k01 host is no longer in use. Remove hosts/k01/ directory and any references in flake.nix.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:46:50.582787562-05:00","updated_at":"2025-12-25T13:56:34.552000874-05:00","closed_at":"2025-12-25T13:56:34.552000874-05:00","close_reason":"Removed hosts/k01/ directory and references from flake.nix"}
{"id":"nix-f3j","title":"Refactor Nix config to eliminate duplication","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-05T15:33:36.704877573-05:00","updated_at":"2025-12-13T02:33:00.589202533-05:00","closed_at":"2025-12-13T02:33:00.589202533-05:00"}
{"id":"nix-f3j.1","title":"Create lib/llama-models.nix model catalog","description":"CREATE lib/llama-models.nix: All model definitions with hf, ctxSize, flashAttn, aliases, extraArgs, opencode metadata. Add model sets (base, macos, large) and helper functions (selectModels, toLlamaSwap, toOpencodeModel). CREATE lib/default.nix: Aggregator that exports mkLlamaSwapModels and mkOpencodeProvider helpers.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T15:33:54.469610264-05:00","updated_at":"2025-12-05T16:11:45.222885281-05:00","closed_at":"2025-12-05T16:11:45.222885281-05:00","dependencies":[{"issue_id":"nix-f3j.1","depends_on_id":"nix-f3j","type":"parent-child","created_at":"2025-12-05T15:33:54.469998315-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-f3j.2","title":"Move llama-swap module to core.nix","description":"CREATE core.nix/home-manager/llama-swap/default.nix: Copy from dotfiles modules/home-manager/llama-swap/. EDIT core.nix/home-manager/default.nix: Add ./llama-swap import. EDIT modules/home-manager/default.nix: Remove llama-swap import. DELETE modules/home-manager/llama-swap/: Moved to core.nix","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T15:33:54.564764695-05:00","updated_at":"2025-12-07T19:06:39.840983202-05:00","closed_at":"2025-12-07T19:06:39.840983202-05:00","dependencies":[{"issue_id":"nix-f3j.2","depends_on_id":"nix-f3j","type":"parent-child","created_at":"2025-12-05T15:33:54.565082504-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-f3j.3","title":"Remove unused gguf-downloader package","description":"DELETE pkgs/gguf-downloader/: No longer needed. EDIT pkgs/default.nix: Remove gguf-downloader reference if present","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-05T15:33:54.642287962-05:00","updated_at":"2025-12-07T19:09:13.207854906-05:00","closed_at":"2025-12-07T19:09:13.207854906-05:00","dependencies":[{"issue_id":"nix-f3j.3","depends_on_id":"nix-f3j","type":"parent-child","created_at":"2025-12-05T15:33:54.642875688-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-f3j.4","title":"Generate opencode.json from Nix model definitions","description":"EDIT modules/home-manager/opencode/default.nix: Replace static JSON with pkgs.formats.json generation, import model catalog, inject orthancUrl from secrets. EDIT secrets.nix: Add orthancUrl field for Tailscale endpoint. DELETE modules/home-manager/opencode/opencode.json: Now generated at build time","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T15:33:54.820588866-05:00","updated_at":"2025-12-07T12:34:58.082725799-05:00","closed_at":"2025-12-07T12:34:58.082725799-05:00","dependencies":[{"issue_id":"nix-f3j.4","depends_on_id":"nix-f3j","type":"parent-child","created_at":"2025-12-05T15:33:54.820985703-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-f3j.5","title":"Simplify host configs to use model catalog","description":"EDIT hosts/meduseld/home-manager/default.nix: Replace ~40 lines of inline models with llamaModels.selectModels call. EDIT hosts/orthanc/home-manager/default.nix: Replace ~160 lines of inline models with modelSets.base ++ modelSets.large","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:33:55.04087104-05:00","updated_at":"2025-12-05T16:17:24.627551181-05:00","closed_at":"2025-12-05T16:17:24.627551181-05:00","dependencies":[{"issue_id":"nix-f3j.5","depends_on_id":"nix-f3j","type":"parent-child","created_at":"2025-12-05T15:33:55.041263649-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-f3j.6","title":"Consolidate flake.nix devShells with helper function","description":"EDIT flake.nix: Create mkDevShell helper, extract common packages/shellHook, use lib.optionalString for platform-specific sections. Reduces ~95 duplicated lines to ~30.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:33:55.272604634-05:00","updated_at":"2025-12-13T02:28:25.605409394-05:00","closed_at":"2025-12-13T02:28:25.605409394-05:00","dependencies":[{"issue_id":"nix-f3j.6","depends_on_id":"nix-f3j","type":"parent-child","created_at":"2025-12-05T15:33:55.272996372-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-f3j.7","title":"Unify flake extraSpecialArgs with helper function","description":"EDIT flake.nix: Create mkExtraSpecialArgs helper, update all 4 homeConfigurations to use it instead of duplicated attrsets.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:33:55.497140066-05:00","updated_at":"2025-12-13T02:32:52.414323119-05:00","closed_at":"2025-12-13T02:32:52.414323119-05:00","dependencies":[{"issue_id":"nix-f3j.7","depends_on_id":"nix-f3j","type":"parent-child","created_at":"2025-12-05T15:33:55.497483122-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-f3j.8","title":"Migrate secrets from git-crypt to pure Nix solution","description":"Current git-crypt setup requires --impure flag for home-manager switch. Investigate alternatives: agenix, sops-nix, or ragenix. Goal: secrets management that works with pure Nix evaluation. EDIT secrets.nix and any modules that read secrets.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:36:03.000787015-05:00","updated_at":"2025-12-05T15:36:58.469189288-05:00","closed_at":"2025-12-05T15:36:58.469189288-05:00","dependencies":[{"issue_id":"nix-f3j.8","depends_on_id":"nix-f3j","type":"parent-child","created_at":"2025-12-05T15:36:03.001172965-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-fwo","title":"Add git push to Claude Code deny list in core.nix","description":"git push should require explicit approval. Add to deny list in core.nix Claude config so it applies across all machines.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:58:15.858588771-05:00","updated_at":"2025-12-13T22:07:34.053067373-05:00","closed_at":"2025-12-13T22:07:34.053067373-05:00"}
{"id":"nix-i7l","title":"Add nixos-generators flake input","description":"Add nixos-generators as a flake input to enable QCOW2 VM image generation.\n\n## Changes needed in flake.nix:\n\n1. Add to inputs (after duckduckgo-mcp-server):\n```nix\nnixos-generators = {\n  url = \"github:nix-community/nixos-generators\";\n  inputs.nixpkgs.follows = \"nixpkgs-nixos\";\n};\n```\n\n2. Add to outputs function parameters (around line 50):\n```nix\nnixos-generators,\n```\n\n## Verification:\n```bash\nnix flake check\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:30:56.583822265-05:00","updated_at":"2025-12-23T23:34:54.044967895-05:00","closed_at":"2025-12-23T23:34:54.044967895-05:00","close_reason":"Closed"}
{"id":"nix-j33","title":"Add .mcp.json with mcp-nixos server configuration","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T14:17:13.232156399-05:00","updated_at":"2025-12-13T14:41:34.103471531-05:00","closed_at":"2025-12-13T14:41:34.103471531-05:00"}
{"id":"nix-jiw","title":"Add image generation","description":"Create image-home-manager.nix and add mkVMImage helper + packages output.\n\n## File: hosts/imladris/nixos/image-home-manager.nix\n\n```nix\n# Only used for image generation - bakes home-manager into the initial image\n{\n  username,\n  home-manager,\n  core,\n  ...\n}:\n\n{\n  imports = [\n    home-manager.nixosModules.home-manager\n  ];\n\n  home-manager = {\n    useGlobalPkgs = true;\n    useUserPackages = true;\n    users.${username} = {\n      imports = [\n        core.home-manager\n        ../home-manager\n      ];\n      home.stateVersion = \"25.05\";\n    };\n    extraSpecialArgs = {\n      inherit username;\n      homeDirectory = \"/home/${username}\";\n    };\n  };\n}\n```\n\n## Changes to flake.nix:\n\n1. Add mkVMImage helper in the let block:\n```nix\nmkVMImage = { hostname, diskSize ? 32 * 1024 }:\n  nixos-generators.nixosGenerate {\n    system = \"x86_64-linux\";\n    format = \"qcow-efi\";\n    modules = [\n      ./hosts/${hostname}/nixos\n      ./hosts/${hostname}/nixos/image-home-manager.nix\n      { virtualisation.diskSize = diskSize; }\n    ];\n    specialArgs = {\n      inherit username home-manager core;\n    };\n  };\n```\n\n2. Add packages output (after devShells):\n```nix\npackages.\"x86_64-linux\".imladris-qcow2 = mkVMImage { hostname = \"imladris\"; };\n```\n\n## Verification:\n```bash\nnix flake check\nnix build .#imladris-qcow2\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:34:16.926546167-05:00","updated_at":"2025-12-23T23:48:05.495391993-05:00","closed_at":"2025-12-23T23:48:05.495391993-05:00","close_reason":"Added mkVMImage helper and packages.x86_64-linux.imladris-qcow2 output. Verified with nix flake check and nix build --dry-run."}
{"id":"nix-kd4","title":"Remove small-models group override from meduseld","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-07T18:35:14.106307664-05:00","updated_at":"2025-12-07T18:35:26.315069838-05:00","closed_at":"2025-12-07T18:35:26.315069838-05:00"}
{"id":"nix-lak","title":"Fix sirannon home-manager to be truly barebones","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T10:11:34.947954716-05:00","updated_at":"2025-12-23T10:13:16.052691273-05:00","closed_at":"2025-12-23T10:13:16.052691273-05:00","close_reason":"Closed"}
{"id":"nix-lgy","title":"Rename mkVMImage helper to base_vm","description":"## Summary\n\nCreate a minimal `base-vm` host template for spinning up new VMs. Remove `imladris-qcow2` and add documentation for the VM provisioning workflow.\n\n## Tasks\n\n1. Create `hosts/base-vm/nixos/default.nix` - minimal NixOS config (base, vm, nfs-synology)\n2. Create `hosts/base-vm/nixos/image-home-manager.nix` - bakes home-manager into image\n3. Create `hosts/base-vm/home-manager/default.nix` - minimal home-manager config\n4. Update `flake.nix` - remove imladris-qcow2, add comment explaining image generation\n5. Update `CLAUDE.md` - add VM Provisioning section with full workflow\n\n## Base VM Contains\n\n**Included:**\n- base.nix (user, SSH, Tailscale, zsh, linger)\n- vm.nix (QEMU guest, EFI boot, auto-resize)\n- nfs-synology (backups mount only)\n- core.home-manager\n\n**Not included:**\n- No secrets (add per-host)\n- No host-specific services (jellarr, jellyfin)\n- No host-specific packages","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:29:51.333210642-05:00","updated_at":"2025-12-24T22:28:08.935521064-05:00","closed_at":"2025-12-24T22:28:08.935521064-05:00","close_reason":"Closed"}
{"id":"nix-m1h","title":"Scheduled nightly model backups for orthanc","description":"## Summary\n\nAdd systemd user timer for nightly rsync backups at 1am on orthanc:\n- `~/.local/share/llama-models/` → `/mnt/backups/models/llm-models/`\n- `~/.local/share/whisper-models/` → `/mnt/backups/models/whisper-models/`\n\n---\n\n## Implementation Steps\n\n### 1. Enable linger in `modules/nixos/base.nix`\n\nEnsure user timers run at boot without login (applies to all NixOS hosts):\n\n```nix\nusers.users.${username}.linger = true;\n```\n\n### 2. Add to `hosts/orthanc/home-manager/default.nix`\n\nAdd systemd user service and timer (similar pattern to llama-swap):\n\n```nix\nsystemd.user.services.model-backup = {\n  Unit.Description = \"Backup LLM and Whisper models to NAS\";\n  Service = {\n    Type = \"oneshot\";\n    ExecStart = \"${pkgs.writeShellScript \"model-backup\" '\n      ${pkgs.rsync}/bin/rsync -aP \\\n        ${config.home.homeDirectory}/.local/share/llama-models/ \\\n        /mnt/backups/models/llm-models/\n      ${pkgs.rsync}/bin/rsync -aP \\\n        ${config.home.homeDirectory}/.local/share/whisper-models/ \\\n        /mnt/backups/models/whisper-models/\n    '}\";\n  };\n};\n\nsystemd.user.timers.model-backup = {\n  Unit.Description = \"Nightly model backup timer\";\n  Timer = {\n    OnCalendar = \"*-*-* 01:00:00\";\n    Persistent = true;\n  };\n  Install.WantedBy = [ \"timers.target\" ];\n};\n```\n\n### 3. Apply and Test\n\n```bash\nsudo nixos-rebuild switch --flake .#orthanc  # for linger\nhome-manager switch --flake .                 # for timer\n\n# Verify linger\nloginctl show-user qmx | grep Linger\n\n# Check timer\nsystemctl --user status model-backup.timer\nsystemctl --user start model-backup.service  # manual test\n```\n\n---\n\n## Files to Modify\n\n| File | Action |\n|------|--------|\n| `modules/nixos/base.nix` | Add `users.users.${username}.linger = true` |\n| `hosts/orthanc/home-manager/default.nix` | Add service + timer |\n\n---\n\n## Design Decisions\n\n1. **Home-manager vs NixOS**: User-level systemd matches existing llama-swap pattern\n2. **Linger in base.nix**: All NixOS hosts benefit from persistent user services\n3. **rsync flags**: `-aP` (no --delete) - safer, avoids mirroring accidental deletions\n4. **Persistent timer**: Runs on next boot if machine was off at 1am","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T14:04:57.423953083-05:00","updated_at":"2025-12-24T22:11:14.116212415-05:00","closed_at":"2025-12-24T22:11:14.116212415-05:00","close_reason":"Closed"}
{"id":"nix-msp","title":"Migrate sirannon to new modules","description":"Update hosts/sirannon/nixos/default.nix to use new modules.\n\nDepends on:\n- nix-8e7: Create modules/nixos/yubikey.nix\n- nix-e4u: Extend base.nix with timezone, experimental-features, stateVersion\n\nImport these modules:\n- ../../../modules/nixos/base.nix\n- ../../../modules/nixos/nfs-synology.nix  \n- ../../../modules/nixos/yubikey.nix\n\nConfigure nfs-synology:\n  enable = true;\n  mounts = [ \"models\" \"backups\" \"media\" ];\n\nKeep host-specific:\n- hardware-configuration.nix import\n- boot.loader (extlinux for Pi, NOT systemd-boot)\n- networking.wireless (WiFi)\n- Extra packages: raspberrypi-eeprom, neovim, tmux, wget\n\nVerify: nix flake check","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:51:06.198413439-05:00","updated_at":"2025-12-24T00:54:54.777199862-05:00","closed_at":"2025-12-24T00:54:54.777203399-05:00"}
{"id":"nix-n4x","title":"Improve /commit slash command to default to granular commits - when multiple unrelated changes are present, should default to splitting into separate commits rather than asking","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T14:15:43.509229642-05:00","updated_at":"2025-12-14T23:49:12.255767691-05:00","closed_at":"2025-12-14T23:49:12.255767691-05:00"}
{"id":"nix-ns7","title":"Remove small-models group override from meduseld","description":"The meduseld host config defines a custom 'small-models' group and overrides models to use it via withGroups mapAttrs. This is redundant now that the model catalog has proper group support via the 'coding' group. Should remove the withGroups override and use catalog groups directly.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-07T18:35:26.337095631-05:00","updated_at":"2025-12-07T19:09:13.190980511-05:00","closed_at":"2025-12-07T19:09:13.190980511-05:00"}
{"id":"nix-o4t","title":"Create modules/nixos/base.nix","description":"Create base NixOS module for all hosts with user setup, SSH, Tailscale, and basic packages.\n\n## File: modules/nixos/base.nix\n\n```nix\n{ config, lib, pkgs, username, ... }:\n\n{\n  # User setup\n  users.users.${username} = {\n    isNormalUser = true;\n    shell = pkgs.zsh;\n    extraGroups = [ \"wheel\" ];\n    openssh.authorizedKeys.keyFiles = [\n      (builtins.fetchurl {\n        url = \"https://github.com/qmx.keys\";\n        sha256 = \"0yz3qk6dwfx4jivm7ljd0p6rmqn4rdnbz1gwn7yh5ryy5mcjr2b1\";\n      })\n    ];\n  };\n\n  # Core services\n  services.openssh.enable = true;\n  services.tailscale.enable = true;\n  services.timesyncd.enable = true;\n\n  # Shell and packages\n  programs.zsh.enable = true;\n  environment.systemPackages = with pkgs; [ vim git ];\n}\n```\n\n## Directory structure:\n- Create modules/nixos/ directory if it doesn't exist\n\n## Verification:\n```bash\nnix flake check\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:32:09.844679401-05:00","updated_at":"2025-12-23T23:35:36.61874913-05:00","closed_at":"2025-12-23T23:35:36.61874913-05:00","close_reason":"Closed"}
{"id":"nix-ozo","title":"Update CLAUDE.md with nix-prefetch-github instructions","description":"Add instructions showing how to run nix-prefetch-github properly using 'nix run nixpkgs#nix-prefetch-github -- owner repo --rev tag' instead of assuming the tool is installed directly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T08:58:24.551828301-05:00","updated_at":"2025-12-13T14:23:05.669121835-05:00","closed_at":"2025-12-13T14:23:05.669121835-05:00"}
{"id":"nix-pjv","title":"Enable llama-server metrics","description":"Add enableMetrics option to llama-swap module (default: true). Exposes Prometheus endpoint at /metrics.\n\n## File to Modify\n\n**modules/home-manager/llama-swap/default.nix**\n\n### Add option (after healthCheckTimeout in options section):\n\n```nix\nenableMetrics = lib.mkOption {\n  type = lib.types.bool;\n  default = true;\n  description = \"Enable Prometheus metrics at /metrics\";\n};\n```\n\n### Update buildCmd function (around line 58):\n\nAdd after `flashAttnArg`:\n```nix\nmetricsArg = lib.optional cfg.enableMetrics \"--metrics\";\n```\n\nUpdate the concatenation:\n```nix\nlib.concatStringsSep \" \" (baseArgs ++ flashAttnArg ++ metricsArg ++ draftArgs ++ extraArgs);\n```\n\n## Verification\n```bash\n# After model loads\ncurl http://localhost:8080/metrics\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:29:24.017104102-05:00","updated_at":"2025-12-25T12:20:16.605231844-05:00","closed_at":"2025-12-25T12:20:16.605231844-05:00","close_reason":"Closed"}
{"id":"nix-q2k","title":"Set up local Nix binary cache using Attic with NFS storage","description":"Set up a self-hosted Nix binary cache using Attic with MinIO for S3-compatible storage. This enables caching HuggingFace models and other custom derivations for the home lab network.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:55:15.686208945-05:00","updated_at":"2025-12-25T15:11:37.424737027-05:00","closed_at":"2025-12-25T15:11:37.424737027-05:00","close_reason":"Implemented erebor VM with Attic binary cache server, NFS storage on Synology, SQLite database"}
{"id":"nix-r1c","title":"Migrate secrets from git-crypt to pure Nix solution","description":"## Problem\n\nCurrent git-crypt setup requires `--impure` flag for home-manager switch because `secrets.nix` uses `builtins.getEnv \"HOME\"` at evaluation time.\n\n## Research Summary\n\n### Options Evaluated\n\n| Approach | Complexity | Templating | Verdict |\n|----------|------------|------------|---------|\n| agenix | Medium | None built-in | One file per secret, awkward for structured data |\n| sops-nix | High | `${config.sops.placeholder.x}` | Full sops setup, .sops.yaml rules |\n| scalpel | Medium | `\\!\\!PLACEHOLDER\\!\\!` | Works with any backend |\n| Surma's approach | Low | None | Simple age, custom module |\n| envsubst | Low | `${VAR}` | Bad for arrays/complex JSON |\n| **minijinja + age** | Low | `{{ x \\| tojson }}` | Best fit - handles complex structures |\n\n### Key Insight\n\nThe problem is reading secrets at **evaluation time** (requires --impure). Solution: decrypt and render templates at **activation time** (pure).\n\n### Chosen Approach: age + minijinja\n\n1. **age** for encryption (like Surma's nixenv) - simple, uses SSH keys\n2. **minijinja** for templating - Rust-based (9MB), has `tojson` filter for valid JSON output\n\n### Current Secret Consumers\n\n1. `secrets.braveApiKey` → env var in opencode module (`modules/home-manager/opencode/default.nix:127`)\n2. `secrets.orthancUrl` → embedded in opencode.json (`hosts/meduseld/home-manager/default.nix:54`)\n3. `secrets.homebridge.*` → complex nested config with cameras array (`hosts/wk3/home-manager/homebridge.nix`)\n\n### Template Example (homebridge)\n\n```jinja\n{\n  \"bridge\": {\n    \"username\": {{ bridge.username | tojson }},\n    \"pin\": {{ bridge.pin | tojson }}\n  },\n  \"cameras\": {{ cameras | tojson }}\n}\n```\n\nThe `tojson` filter handles strings, arrays, objects correctly - outputs valid JSON.\n\n## Implementation Plan\n\n1. Create `modules/secrets/default.nix` - age decryption + minijinja templating module\n2. Create `secrets/` directory with age-encrypted JSON files\n3. Create `templates/` directory with .j2 template files\n4. Migrate each consumer to use templates\n5. Remove git-crypt, delete old secrets.nix\n6. Update flake.nix to remove `secrets` from extraSpecialArgs\n\n## References\n\n- [Surma's nixenv secrets](https://github.com/surma/nixenv/tree/main/secrets)\n- [sops-nix templates](https://github.com/Mic92/sops-nix)\n- [scalpel](https://github.com/polygon/scalpel)\n- [minijinja](https://github.com/mitsuhiko/minijinja)","notes":"## Decision Log\n\n**Key management decision**: Master age key stored in 1Password (base64 encoded).\n\nAlternatives evaluated and rejected:\n- **age-plugin-yubikey (PIV)**: Touch required for decrypt, doesn't work for remote machines with plugged-in YubiKeys\n- **age-plugin-yubikey (no-touch)**: Security similar to file-based key, adds complexity\n- **age-plugin-gpg**: Not in nixpkgs, requires gpg-agent integration\n- **age-plugin-openpgp-card**: Additional complexity, unclear gpg-agent interaction\n- **Native age SSH support**: Doesn't work with ssh-agent/gpg-agent, requires actual key file\n\nMaster key in 1Password is simplest and meets security requirements.\n\n## Key Setup (one-time)\n\n```bash\n# Generate master age key\nage-keygen -o master.key\n# Output: Public key: age1xxxxxxx...\n\n# Store as base64 in 1Password\ncat master.key | base64\n# Save to 1Password as \"Age Master Key\"\n\n# Delete local copy\nrm master.key\n```\n\n## Per-machine Setup\n\n```bash\nmkdir -p ~/.config/age\necho '\u003cbase64 from 1Password\u003e' | base64 -d \u003e ~/.config/age/keys.txt\nchmod 600 ~/.config/age/keys.txt\n```\n\n## Encrypting Secrets\n\n```bash\n# Public key in secrets/recipients.txt\nage -R secrets/recipients.txt -o secrets/foo.age \u003c plaintext\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:36:58.523779832-05:00","updated_at":"2025-12-13T01:53:46.126254094-05:00","closed_at":"2025-12-13T01:53:46.126254094-05:00"}
{"id":"nix-r1c.1","title":"Create secrets module (modules/secrets/default.nix)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:37.951813404-05:00","updated_at":"2025-12-13T01:49:39.794888029-05:00","closed_at":"2025-12-13T01:49:39.794888029-05:00","dependencies":[{"issue_id":"nix-r1c.1","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:37.952390953-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.10","title":"Cleanup old secrets infrastructure","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-13T01:37:38.616018415-05:00","updated_at":"2025-12-13T01:49:44.185744979-05:00","closed_at":"2025-12-13T01:49:44.185744979-05:00","dependencies":[{"issue_id":"nix-r1c.10","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.6163498-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.11","title":"Update CLAUDE.md with secrets documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.692882659-05:00","updated_at":"2025-12-13T01:49:44.192096641-05:00","closed_at":"2025-12-13T01:49:44.192096641-05:00","dependencies":[{"issue_id":"nix-r1c.11","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.693334261-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.2","title":"Encrypt secrets with age","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.018355223-05:00","updated_at":"2025-12-13T01:49:39.803275294-05:00","closed_at":"2025-12-13T01:49:39.803275294-05:00","dependencies":[{"issue_id":"nix-r1c.2","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.018691417-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.3","title":"Create env.j2 template","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.085730413-05:00","updated_at":"2025-12-13T01:49:39.810090349-05:00","closed_at":"2025-12-13T01:49:39.810090349-05:00","dependencies":[{"issue_id":"nix-r1c.3","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.086076165-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.4","title":"Create opencode.json.j2 template","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.161110418-05:00","updated_at":"2025-12-13T01:49:39.817328641-05:00","closed_at":"2025-12-13T01:49:39.817328641-05:00","dependencies":[{"issue_id":"nix-r1c.4","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.161438076-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.5","title":"Create homebridge.json.j2 template","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.229760854-05:00","updated_at":"2025-12-13T01:49:39.825030316-05:00","closed_at":"2025-12-13T01:49:39.825030316-05:00","dependencies":[{"issue_id":"nix-r1c.5","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.23015677-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.6","title":"Update flake.nix (remove secrets, add age)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.306252465-05:00","updated_at":"2025-12-13T01:49:44.156524147-05:00","closed_at":"2025-12-13T01:49:44.156524147-05:00","dependencies":[{"issue_id":"nix-r1c.6","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.306669692-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.7","title":"Migrate meduseld config","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.385085331-05:00","updated_at":"2025-12-13T01:49:44.164935899-05:00","closed_at":"2025-12-13T01:49:44.164935899-05:00","dependencies":[{"issue_id":"nix-r1c.7","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.385507768-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.8","title":"Migrate wk3 config","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.457796293-05:00","updated_at":"2025-12-13T01:49:44.171744572-05:00","closed_at":"2025-12-13T01:49:44.171744572-05:00","dependencies":[{"issue_id":"nix-r1c.8","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.458217237-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-r1c.9","title":"Migrate k01 and orthanc configs","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T01:37:38.532065935-05:00","updated_at":"2025-12-13T01:49:44.179237263-05:00","closed_at":"2025-12-13T01:49:44.179237263-05:00","dependencies":[{"issue_id":"nix-r1c.9","depends_on_id":"nix-r1c","type":"parent-child","created_at":"2025-12-13T01:37:38.532478743-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"nix-rdw","title":"Generic bump script","description":"Replace bump-opencode with generic bump command. Report-only mode with manual update instructions.\n\n## Packages to Support\n\n| Package | Source Type | Version Location |\n|---------|-------------|------------------|\n| opencode | Flake input | flake.nix line ~18: url = \"github:sst/opencode/...\" |\n| llama-cpp | Overlay | pkgs/default.nix: version = \"7524\" |\n| llama-swap | Package | pkgs/llama-swap/default.nix: version = \"177\" |\n| beads-viewer | Package | pkgs/beads-viewer/default.nix: version = \"0.10.2\" |\n| perles | Package | pkgs/perles/default.nix (after nix-c8s) |\n\n## Files to Create/Modify\n\n1. **Create** `scripts/bump.sh`\n   - Package registry with GitHub repos and version patterns\n   - Fetch latest from GitHub API\n   - Compare current vs latest version\n   - Print manual update instructions\n\n2. **Modify** `flake.nix`\n   - Replace mkBumpOpencode (lines 77-85) with mkBumpScript\n   - Update devShell buildInputs to use (mkBumpScript targetPkgs)\n\n3. **Modify** `CLAUDE.md`\n   - Update Available tools: change `bump-opencode` to `bump`\n\n## Usage\n```bash\nbump opencode      # Check single package\nbump llama-cpp     # Check llama.cpp\nbump --all         # Check all packages\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:29:23.948497935-05:00","updated_at":"2025-12-25T11:36:01.134999863-05:00","closed_at":"2025-12-25T11:36:01.134999863-05:00","close_reason":"Closed"}
{"id":"nix-rm9","title":"Fix Home Manager version mismatch on orthanc (25.11 vs 26.05)","description":"home-manager switch on orthanc shows warning:\n\n  Home Manager version 25.11 and Nixpkgs version 26.05.\n\nThis happened because we pinned home-manager to release-25.11 for NixOS VMs (which use nixpkgs-nixos 25.11), but orthanc's home-manager config uses nixpkgs-unstable (26.05).\n\nOptions:\n1. Use separate home-manager inputs (one for NixOS VMs, one for standalone)\n2. Pin nixpkgs for orthanc home-manager to match 25.11\n3. Use home-manager master for everything and suppress warning in VM configs\n\nNeed to decide on approach.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T01:08:27.345481309-05:00","updated_at":"2025-12-24T01:32:50.744110937-05:00","closed_at":"2025-12-24T01:32:50.744114213-05:00"}
{"id":"nix-ucr","title":"Create ncps wrapper module","description":"Create modules/nixos/ncps.nix - wrapper around services.ncps with options for storagePath, maxSize (500G default), port (8081 default). Configure upstream to cache.nixos.org, enable prometheus metrics, add NFS mount dependency.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T17:13:51.206170201-05:00","updated_at":"2025-12-25T17:20:22.363617458-05:00","closed_at":"2025-12-25T17:20:22.363617458-05:00","close_reason":"Closed"}
{"id":"nix-vb2","title":"Jellyfin + jellarr on imladris","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:53:11.788607731-05:00","updated_at":"2025-12-24T12:03:29.373118824-05:00","closed_at":"2025-12-24T12:03:29.373118824-05:00","close_reason":"Closed"}
{"id":"nix-vb2.1","title":"Create NixOS secrets module (modules/nixos/secrets.nix)","description":"Mirror the home-manager secrets pattern for NixOS system services. Uses age encryption, decrypts to /run/secrets/ during activation. Same secrets.json.age file.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:53:17.399995295-05:00","updated_at":"2025-12-24T03:06:02.068046281-05:00","closed_at":"2025-12-24T03:06:02.068046281-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-vb2.1","depends_on_id":"nix-vb2","type":"parent-child","created_at":"2025-12-24T02:53:17.403655947-05:00","created_by":"daemon"}]}
{"id":"nix-vb2.2","title":"Copy age key to imladris","description":"One-time setup: copy ~/.config/age/keys.txt to /root/.config/age/keys.txt on imladris for NixOS-level secret decryption.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:53:22.423222735-05:00","updated_at":"2025-12-24T12:03:18.868992498-05:00","closed_at":"2025-12-24T12:03:18.868992498-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-vb2.2","depends_on_id":"nix-vb2","type":"parent-child","created_at":"2025-12-24T02:53:22.425595673-05:00","created_by":"daemon"}]}
{"id":"nix-vb2.3","title":"Create Jellyfin module (modules/nixos/jellyfin.nix)","description":"Basic Jellyfin module with NFS dependency. Waits for mnt-media.automount before starting. Opens firewall, adds jellyfin user to render/video groups.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:53:27.422449965-05:00","updated_at":"2025-12-24T03:06:02.070988201-05:00","closed_at":"2025-12-24T03:06:02.070988201-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-vb2.3","depends_on_id":"nix-vb2","type":"parent-child","created_at":"2025-12-24T02:53:27.425769305-05:00","created_by":"daemon"}]}
{"id":"nix-vb2.4","title":"Add jellarr flake input","description":"Add jellarr to flake.nix inputs, wire nixosModules.default to imladris configuration.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:53:31.580253481-05:00","updated_at":"2025-12-24T03:06:02.072431399-05:00","closed_at":"2025-12-24T03:06:02.072431399-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-vb2.4","depends_on_id":"nix-vb2","type":"parent-child","created_at":"2025-12-24T02:53:31.584795373-05:00","created_by":"daemon"}]}
{"id":"nix-vb2.5","title":"Add jellarr API key to secrets.json.age","description":"Generate random 32-char API key, add jellarr.apiKey to secrets.json, re-encrypt with age.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:53:39.445649435-05:00","updated_at":"2025-12-24T03:06:02.073889705-05:00","closed_at":"2025-12-24T03:06:02.073889705-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-vb2.5","depends_on_id":"nix-vb2","type":"parent-child","created_at":"2025-12-24T02:53:39.449094632-05:00","created_by":"daemon"}]}
{"id":"nix-vb2.6","title":"Create jellarr secrets activation (modules/nixos/jellarr-secrets.nix)","description":"Activation script that extracts jellarr.apiKey from /run/secrets/data.json, writes to /run/secrets/jellarr-api-key and /run/secrets/jellarr.env for bootstrap and service.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:53:45.030418021-05:00","updated_at":"2025-12-24T03:06:02.07527314-05:00","closed_at":"2025-12-24T03:06:02.07527314-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-vb2.6","depends_on_id":"nix-vb2","type":"parent-child","created_at":"2025-12-24T02:53:45.033620411-05:00","created_by":"daemon"}]}
{"id":"nix-vb2.7","title":"Configure imladris with Jellyfin + jellarr","description":"Update hosts/imladris/nixos/default.nix: import new modules, enable nixos-secrets, media-server, and jellarr with auto-bootstrap. Movies library at /mnt/media/Movies.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:53:53.872425659-05:00","updated_at":"2025-12-24T03:06:02.076524276-05:00","closed_at":"2025-12-24T03:06:02.076524276-05:00","close_reason":"Closed","dependencies":[{"issue_id":"nix-vb2.7","depends_on_id":"nix-vb2","type":"parent-child","created_at":"2025-12-24T02:53:53.875154237-05:00","created_by":"daemon"}]}
{"id":"nix-vca","title":"Configure whisper model on orthanc","description":"Add whisper proxyModel to orthanc config with model at ~/.local/share/whisper-models/ggml-large-v3-turbo.bin, port 9233, checkEndpoint /v1/audio/transcriptions/","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T21:57:04.575375023-05:00","updated_at":"2025-12-22T22:00:14.024933296-05:00","closed_at":"2025-12-22T22:00:14.024933296-05:00","close_reason":"Added whisper proxyModel config on orthanc with whisper-cpp-vulkan, port 9233, checkEndpoint /v1/audio/transcriptions/, model at ~/.local/share/whisper-models/ggml-large-v3-turbo.bin","dependencies":[{"issue_id":"nix-vca","depends_on_id":"nix-cpc","type":"parent-child","created_at":"2025-12-22T21:57:18.206689834-05:00","created_by":"daemon"},{"issue_id":"nix-vca","depends_on_id":"nix-cwq","type":"blocks","created_at":"2025-12-22T21:57:22.408748466-05:00","created_by":"daemon"}]}
{"id":"nix-w7l","title":"Fix gpgconf not found in linux-yubikey role","description":"SSH to imladris shows:\n\n  /home/qmx/.zshrc:50: command not found: gpgconf\n\nThe linux-yubikey role uses gpgconf in zsh init but doesn't install gnupg.\n\nFix: Add pkgs.gnupg to home.packages in roles/linux-yubikey/home-manager/default.nix","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T01:40:24.166322756-05:00","updated_at":"2025-12-24T01:44:41.113451136-05:00","closed_at":"2025-12-24T01:44:41.113451136-05:00","close_reason":"Added gnupg to linux-yubikey role and pkgs-unstable to image-home-manager.nix"}
{"id":"nix-y9m","title":"Add Qwen3-VL-32B model to orthanc","description":"Add unsloth/Qwen3-VL-32B-Instruct-GGUF:Q8_K_XL to orthanc's model catalog.\n\n## Model Details\n- HF: unsloth/Qwen3-VL-32B-Instruct-GGUF:Q8_K_XL\n- KV Cache: Q8 (--cache-type-k q8_0 --cache-type-v q8_0)\n- Vision model - supports image input\n\n## Files to Modify\n- lib/models.nix - add model definition\n- hosts/orthanc/home-manager/default.nix - add to localModels\n\n## Research Required\n- Check HuggingFace model card for context length and recommended parameters\n- Determine if flash attention is supported for VL models","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T12:32:23.786562554-05:00","updated_at":"2025-12-25T12:38:15.385132348-05:00","closed_at":"2025-12-25T12:38:15.385132348-05:00","close_reason":"Closed"}
{"id":"nix-yx5","title":"Import Framework Desktop module in nixosConfigurations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T23:29:19.69698845-05:00","updated_at":"2025-12-17T23:30:01.48306823-05:00","closed_at":"2025-12-17T23:30:01.48306823-05:00"}
{"id":"nix-zxq","title":"Add whisper-cpp-vulkan package to Linux config","description":"Add pkgs.whisper-cpp-vulkan to Linux packages in modules/home-manager/default.nix","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T21:57:04.403853317-05:00","updated_at":"2025-12-22T21:58:55.922501588-05:00","closed_at":"2025-12-22T21:58:55.922501588-05:00","close_reason":"Added pkgs.whisper-cpp-vulkan to Linux packages in modules/home-manager/default.nix","dependencies":[{"issue_id":"nix-zxq","depends_on_id":"nix-cpc","type":"parent-child","created_at":"2025-12-22T21:57:18.173094388-05:00","created_by":"daemon"}]}
